#!/usr/bin/perl
use strict;
use warnings;

my @devs = qw(ppp eth wlan);
my $tethering = 'tethering';
my $none = 'none';
my $okStatuses = join ',', ($none, $tethering, @devs);


sub getDev();
sub isTethering();

my $usage = "Usage: $0  print one of [$okStatuses]\n";

sub main(@){
  die $usage if @_ > 0;
  my $status = getDev();
  $status = $tethering if not defined $status and isTethering();
  $status = $none if not defined $status;
  print "$status\n";
}

sub getDev(){
  my @devs = qw(ppp eth wlan);
  my $netstat = `ifconfig -s`;

  for my $dev(@devs){
    my $device = `ifdev $dev`;
    chomp $device;
    if($? == 0 and $netstat =~ /^$device /m){
      if($dev eq 'wlan'){
        my $iwconfig = `iwconfig $device`;
        if($iwconfig =~ /ESSID:off\/any\s*$/m){
          next;
        }
      }
      if(`ifconfig $device` =~ /inet addr/){
        return $dev;
      }
    }
  }
  return undef;
}

sub isTethering(){
  system "pidof pppd wvdial > /dev/null 2>/dev/null";
  return $? == 0;
}

&main(@ARGV);
